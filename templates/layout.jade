doctype html
block vars
  - var bodyclass = null;
  - locals.meta = locals.meta || {};
html(lang='en' ng-app="padd")
  head
    block head
      meta(charset='utf-8')
      meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
      meta(name='viewport', content='width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no')
      title
        block title
          = locals.name
      //- Billy will let us know later when to use meta tags.
      //- The defaults can be set in ./config.json
      //- meta(name="description" content=locals.meta.description)
      //- meta(name="keywords" content=locals.meta.keywords)
      meta(name="keywords" content="")
      meta(name="keywords" content="")
      link(rel="shortcut icon" type="image/ico" href="https://www.respoke.io/favicon.ico")
      link(type="text/css" rel="stylesheet" href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700|Source+Code+Pro')
      link(rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css")
      link(rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css")

      link(type="text/css" rel='stylesheet', href='https://www.respoke.io/min/production.css')

      link(rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/docco.min.css")

      link(type="text/css" rel='stylesheet', href='/css/site.css')

      script(src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.13/angular.min.js")
      script(src="https://yandex.st/highlightjs/8.0/highlight.min.js")

      script(src="/js/padd.js")
  body(data-spy="scroll" data-target=".secondary-nav")
    #wrap
      .public-site

        include header


        // Main Page Content
        region
          .how-it-works(ng-controller="NavController")
            .how-it-works-container
              #content
                .row
                  .col-md-2
                    //- Article navigation is generated by a wintersmith plugin so it can be used by jsdoxy files
                    //- also, it is sort-of affixed here
                    include sidebar
                  .col-md-7
                    .content-wrap
                      button#sidebar-toggle-button.btn.btn.xl.btn-primary(onclick="$('#main-sidebar').toggle();$(this).find('i.glyphicon').toggleClass('hide');")
                        i.glyphicon.glyphicon-th-list
                        i.glyphicon.glyphicon-remove.hide
                      block content

                      br
                      br
                      br
                      br
                  .col-md-3
                    block right-nav

      // Footer
      region
        footer
          .content-wrap
            block footer
              section.copy
                .footer
                  div(class="footer-container")
                    div(class="footer-links")
                        a(href="http://digium.com/respoke")
                            img(src="/images/digium_white.png" class="digium-logo")
                    div(class="footer-content")
                        p(class="copy") Copyright &copy; #{ new Date().getFullYear() } D.C.S, LLC
                        p(class="copy")
                            a(href="mailto:info@respoke.io") info@respoke.io
                    div(class="footer-links social-links")
                        a(href="https://twitter.com/respoke")
                            span(class="fa fa-twitter")
                        a(href="https://www.facebook.com/respokeIO")
                            span(class="fa fa-facebook")
                        a(href="https://plus.google.com/110089434291590810767" rel="publisher")
                            span(class="fa fa-google-plus")

script(src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js")
script(src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js")
script(src="https://cdnjs.cloudflare.com/ajax/libs/stellar.js/0.6.2/jquery.stellar.min.js")
script(src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js")
script.
  // Scrollspy
  // TODO: use angular-ui boostrap version instead
  $('body').scrollspy({ target: '.secondary-nav', offset: 150 });

  // parallax by http://markdalgleish.com/projects/stellar.js/
  $.stellar();

  // affixing the sidebar at high resolutions
  var resizeEvent = function(event){
    if($(window).width() > 990) {
        affixLeftSidebar();
    }
  };
  window.addEventListener('resize', resizeEvent);
  resizeEvent();

  // Showing and login and signup
  (function () {
      var token = $.cookie('token');
      var $login = $('.log-in');
      var $logout = $('.log-out');
      var $signup = $('.sign-up');
      var $portal = $('.portal');
      var $wwwlink = $('.www-link');
      var $logo = $('img.logo');

      function loggedIn() {
          $login.remove();
          $signup.remove();

          $portal.css('display', 'inline-block');
          $logout.css('display', 'inline-block');
      }
      function notLoggedIn() {
          $portal.remove();
          $logout.remove();

          //- $login.css('display', 'inline-block');
          //- $signup.css('display', 'inline-block');
      }

      var apiBase = window.location.host.replace('docs', 'api').replace(':2003', ':2000');
      var apiUrl = apiBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
      apiUrl += apiBase + '/v1/admins/me';
      var publicBase = window.location.host.replace('docs', 'www').replace(':2003', ':2001');
      var publicUrl = publicBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
      publicUrl += publicBase;
      var portalBase = window.location.host.replace('docs', 'portal').replace(':2003', ':2002');
      var portalUrl = portalBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
      portalUrl += portalBase;

      if (token) {
          $.ajax({
              url: apiUrl,
              type: 'GET',
              headers: {
                  'Admin-Token': token
              },
              success: loggedIn,
              error: notLoggedIn
          });
      }
      else {
          notLoggedIn();
      }

      $portal.attr('href', portalUrl + $portal.attr('href'));
      $wwwlink.each(function () {
          $(this).attr('href', publicUrl + $(this).attr('href'))
      });
      $logo.attr('src', publicUrl + $logo.attr('src').replace('https://www.respoke.io',''));
  })();

  function logout() {
      $.removeCookie('token', { domain: '.' + window.location.hostname.split('.').slice(-2).join('.') });
      window.location.reload();
  }

  $.ajax({
        url: '//d3px1qgagsf6ei.cloudfront.net/Scripts/f772acdb-7c45-430c-8c5a-28c3bcbb420e',
        crossDomain: true,
        dataType: 'script',
        success: function () {
            Payboard.Events.trackPage;
        },
        error: function () {
            console.log("There was an error retrieving the payboard tracking script");
        }
    });
